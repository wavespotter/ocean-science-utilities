<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>ocean_science_utilities.wavespectra.operations API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>ocean_science_utilities.wavespectra.operations</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">import numpy as np
import xarray

from numba import njit  # type: ignore
from typing import Sequence, TypeVar, Union, Literal, Dict

from ocean_science_utilities.tools.math import wrapped_difference
from ocean_science_utilities.wavespectra.spectrum import (
    FrequencyDirectionSpectrum,
    FrequencySpectrum,
    NAME_D,
    NAME_F,
    SPECTRAL_DIMS,
)


_T = TypeVar(&#34;_T&#34;, FrequencySpectrum, FrequencyDirectionSpectrum)
spec_dims = Literal[&#34;frequency&#34;, &#34;direction&#34;]


def concatenate_spectra(spectra: Sequence[_T], dim=None, keys=None, **kwargs) -&gt; _T:
    &#34;&#34;&#34;
    Concatenate along the given dimension. If the dimension does not exist a new
    dimension will be created. Under the hood this calls the concat function of xarray.
    Named arguments to that function can be applied here as well.

    If dim is set to None - we first flatten the spectral objects - and then join along
    the flattened dimension.

    :param spectra: A sequence of Frequency Spectra/Frequency Direction Spectra
    :param dim: the dimension to concatenate along
    :return: New combined spectral object.
    &#34;&#34;&#34;

    # Concatenate the dataset in the spectral objects using the xarray
    # concatenate function
    dataset = xarray.Dataset()

    if dim is not None:
        # Why are we doing this?
        dataset[dim] = [x.dataset[dim].values for x in spectra]
    else:
        dim = &#34;linear_index&#34;
        spectra = [x.flatten(dim) for x in spectra]

    for variable_name in spectra[0]:
        if variable_name == dim:
            continue

        dataset[variable_name] = xarray.concat(
            [x.dataset[variable_name] for x in spectra], dim=dim, **kwargs
        )

    # Get the class of the input spectra.
    cls = type(spectra[0])

    # Return a class instance.
    return cls(dataset)


def integrate_spectral_data(
    dataset: xarray.DataArray, dims: Union[spec_dims, Sequence[spec_dims]]
) -&gt; xarray.DataArray:
    if isinstance(dims, str):
        dims = [dims]

    for dim in dims:
        if dim not in SPECTRAL_DIMS:
            raise ValueError(
                f&#34;Dimension {dim} is not a spectral dimension,&#34;
                f&#34;options are {NAME_F} or {NAME_D}&#34;
            )

        if dim not in dataset.coords:
            raise ValueError(
                f&#34;Dataset has no {dim} dimension, dimensions are: {list(dataset.dims)}&#34;
            )

    out = dataset
    if NAME_F in dims:
        out = out.fillna(0).integrate(coord=NAME_F)

    if NAME_D in dims:
        difference = xarray.DataArray(
            data=wrapped_difference(
                np.diff(dataset.direction.values, append=dataset.direction[0]),
                period=360,
            ),
            coords={NAME_D: dataset.direction.values},
            dims=[NAME_D],
        )
        out = (out * difference).sum(dim=NAME_D)

    return out


@njit(cache=True, fastmath=True)
def numba_integrate_spectral_data(
    data: np.typing.NDArray, grid: Dict[str, np.ndarray]
) -&gt; float:
    frequency_step = grid[&#34;frequency_step&#34;]
    direction_step = grid[&#34;direction_step&#34;]
    number_of_frequencies = data.shape[-2]
    number_of_directions = data.shape[-1]

    return_value = 0.0
    for frequency_index in range(number_of_frequencies):
        for direction_index in range(number_of_directions):
            return_value += (
                data[frequency_index, direction_index]
                * frequency_step[frequency_index]
                * direction_step[direction_index]
            )
    return return_value


@njit(cache=True, fastmath=True)
def numba_directionally_integrate_spectral_data(
    data: np.typing.NDArray, grid: Dict[str, np.ndarray]
):
    direction_step = grid[&#34;direction_step&#34;]
    number_of_frequencies = data.shape[-2]
    number_of_directions = data.shape[-1]

    return_value = np.empty(number_of_frequencies, dtype=data.dtype)
    for frequency_index in range(number_of_frequencies):
        return_value[frequency_index] = 0.0
        for direction_index in range(number_of_directions):
            return_value[frequency_index] += (
                data[frequency_index, direction_index] * direction_step[direction_index]
            )
    return return_value</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="ocean_science_utilities.wavespectra.operations.concatenate_spectra"><code class="name flex">
<span>def <span class="ident">concatenate_spectra</span></span>(<span>spectra: Sequence[~_T], dim=None, keys=None, **kwargs) ‑> ~_T</span>
</code></dt>
<dd>
<div class="desc"><p>Concatenate along the given dimension. If the dimension does not exist a new
dimension will be created. Under the hood this calls the concat function of xarray.
Named arguments to that function can be applied here as well.</p>
<p>If dim is set to None - we first flatten the spectral objects - and then join along
the flattened dimension.</p>
<p>:param spectra: A sequence of Frequency Spectra/Frequency Direction Spectra
:param dim: the dimension to concatenate along
:return: New combined spectral object.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def concatenate_spectra(spectra: Sequence[_T], dim=None, keys=None, **kwargs) -&gt; _T:
    &#34;&#34;&#34;
    Concatenate along the given dimension. If the dimension does not exist a new
    dimension will be created. Under the hood this calls the concat function of xarray.
    Named arguments to that function can be applied here as well.

    If dim is set to None - we first flatten the spectral objects - and then join along
    the flattened dimension.

    :param spectra: A sequence of Frequency Spectra/Frequency Direction Spectra
    :param dim: the dimension to concatenate along
    :return: New combined spectral object.
    &#34;&#34;&#34;

    # Concatenate the dataset in the spectral objects using the xarray
    # concatenate function
    dataset = xarray.Dataset()

    if dim is not None:
        # Why are we doing this?
        dataset[dim] = [x.dataset[dim].values for x in spectra]
    else:
        dim = &#34;linear_index&#34;
        spectra = [x.flatten(dim) for x in spectra]

    for variable_name in spectra[0]:
        if variable_name == dim:
            continue

        dataset[variable_name] = xarray.concat(
            [x.dataset[variable_name] for x in spectra], dim=dim, **kwargs
        )

    # Get the class of the input spectra.
    cls = type(spectra[0])

    # Return a class instance.
    return cls(dataset)</code></pre>
</details>
</dd>
<dt id="ocean_science_utilities.wavespectra.operations.integrate_spectral_data"><code class="name flex">
<span>def <span class="ident">integrate_spectral_data</span></span>(<span>dataset: xarray.core.dataarray.DataArray, dims: Union[Literal['frequency', 'direction'], Sequence[Literal['frequency', 'direction']]]) ‑> xarray.core.dataarray.DataArray</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def integrate_spectral_data(
    dataset: xarray.DataArray, dims: Union[spec_dims, Sequence[spec_dims]]
) -&gt; xarray.DataArray:
    if isinstance(dims, str):
        dims = [dims]

    for dim in dims:
        if dim not in SPECTRAL_DIMS:
            raise ValueError(
                f&#34;Dimension {dim} is not a spectral dimension,&#34;
                f&#34;options are {NAME_F} or {NAME_D}&#34;
            )

        if dim not in dataset.coords:
            raise ValueError(
                f&#34;Dataset has no {dim} dimension, dimensions are: {list(dataset.dims)}&#34;
            )

    out = dataset
    if NAME_F in dims:
        out = out.fillna(0).integrate(coord=NAME_F)

    if NAME_D in dims:
        difference = xarray.DataArray(
            data=wrapped_difference(
                np.diff(dataset.direction.values, append=dataset.direction[0]),
                period=360,
            ),
            coords={NAME_D: dataset.direction.values},
            dims=[NAME_D],
        )
        out = (out * difference).sum(dim=NAME_D)

    return out</code></pre>
</details>
</dd>
<dt id="ocean_science_utilities.wavespectra.operations.numba_directionally_integrate_spectral_data"><code class="name flex">
<span>def <span class="ident">numba_directionally_integrate_spectral_data</span></span>(<span>data: numpy.ndarray[typing.Any, numpy.dtype[+ScalarType]], grid: Dict[str, numpy.ndarray])</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@njit(cache=True, fastmath=True)
def numba_directionally_integrate_spectral_data(
    data: np.typing.NDArray, grid: Dict[str, np.ndarray]
):
    direction_step = grid[&#34;direction_step&#34;]
    number_of_frequencies = data.shape[-2]
    number_of_directions = data.shape[-1]

    return_value = np.empty(number_of_frequencies, dtype=data.dtype)
    for frequency_index in range(number_of_frequencies):
        return_value[frequency_index] = 0.0
        for direction_index in range(number_of_directions):
            return_value[frequency_index] += (
                data[frequency_index, direction_index] * direction_step[direction_index]
            )
    return return_value</code></pre>
</details>
</dd>
<dt id="ocean_science_utilities.wavespectra.operations.numba_integrate_spectral_data"><code class="name flex">
<span>def <span class="ident">numba_integrate_spectral_data</span></span>(<span>data: numpy.ndarray[typing.Any, numpy.dtype[+ScalarType]], grid: Dict[str, numpy.ndarray]) ‑> float</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@njit(cache=True, fastmath=True)
def numba_integrate_spectral_data(
    data: np.typing.NDArray, grid: Dict[str, np.ndarray]
) -&gt; float:
    frequency_step = grid[&#34;frequency_step&#34;]
    direction_step = grid[&#34;direction_step&#34;]
    number_of_frequencies = data.shape[-2]
    number_of_directions = data.shape[-1]

    return_value = 0.0
    for frequency_index in range(number_of_frequencies):
        for direction_index in range(number_of_directions):
            return_value += (
                data[frequency_index, direction_index]
                * frequency_step[frequency_index]
                * direction_step[direction_index]
            )
    return return_value</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="ocean_science_utilities.wavespectra" href="index.html">ocean_science_utilities.wavespectra</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="ocean_science_utilities.wavespectra.operations.concatenate_spectra" href="#ocean_science_utilities.wavespectra.operations.concatenate_spectra">concatenate_spectra</a></code></li>
<li><code><a title="ocean_science_utilities.wavespectra.operations.integrate_spectral_data" href="#ocean_science_utilities.wavespectra.operations.integrate_spectral_data">integrate_spectral_data</a></code></li>
<li><code><a title="ocean_science_utilities.wavespectra.operations.numba_directionally_integrate_spectral_data" href="#ocean_science_utilities.wavespectra.operations.numba_directionally_integrate_spectral_data">numba_directionally_integrate_spectral_data</a></code></li>
<li><code><a title="ocean_science_utilities.wavespectra.operations.numba_integrate_spectral_data" href="#ocean_science_utilities.wavespectra.operations.numba_integrate_spectral_data">numba_integrate_spectral_data</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>
